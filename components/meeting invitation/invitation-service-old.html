{% if param_case_id %}

    {% fetchxml meeting_query  %}
        <fetch version="1.0" output-format="xml-platform" mapping="logical"  >
            <entity name="av_meeting">
            <attribute name="av_meetingid" />
            <attribute name="av_mode" />
            <attribute name="av_type" />
            <attribute name="av_description" />
            <attribute name="av_totalinteractionsequence" />
            <attribute name="av_case" />
            <attribute name="av_currentinteractionsequence" />
             <filter type="and">
              <condition attribute="av_case" operator="eq" value="{{ param_case_id }}"/>  
             </filter>
            </entity>
        </fetch>
    {% endfetchxml %}

    {% assign meetings = meeting_query.results.entities %}

    {% if meetings.size > 0 %}

        {% fetchxml meeting_time_slot_query %}
            <fetch version="1.0" output-format="xml-platform" mapping="logical">
                <entity name="av_meetingtimeslot">
                <attribute name="av_meetingtimeslotid" />
                <attribute name="av_name" />
                <attribute name="statuscode" />
                <attribute name="av_startdatetime" />
                <attribute name="av_meetingday" />
                <attribute name="av_duration" />
                <attribute name="av_specialist" />
                <attribute name="av_meeting" />
                <filter type="and">
                 <condition attribute="av_meeting" operator="in">
                    {% for meeting in meetings %}
                     <value>{{ meeting.av_meetingid }}</value>
                    {% endfor %}
                 </condition>
                </filter>  
                </entity>
            </fetch>
        {% endfetchxml %}

        {% assign meeting_time_slots = meeting_time_slot_query.results.entities %}

        {% fetchxml invitation_query  %}
            <fetch version="1.0" output-format="xml-platform" mapping="logical"  >
                <entity name="av_invitation">
                <attribute name="av_invitationid" />
                <attribute name="av_location" />
                <attribute name="av_interactionsequence" />
                <attribute name="av_invitee" />
                <attribute name="statuscode" />
                <attribute name="av_meeting" />
                <filter type="and">
                  <condition attribute="av_meeting" operator="in">
                    {% for meeting in meetings %}
                        <value>{{ meeting.av_meetingid }}</value>
                    {% endfor %}
                  </condition>

                  <condition attribute="av_invitee" operator="eq" value="{{ user.id }}" />
                </filter>    
                </entity>
            </fetch>
        {% endfetchxml %}

        {% assign invitations = invitation_query.results.entities %}

    {% endif %}
    
{% if invitations.size > 0 %}

{% fetchxml selected_meeting_time_slot_query %}
    <fetch version="1.0" output-format="xml-platform" mapping="logical">
  <entity name="av_meetingtimeslot">
    <attribute name="av_meetingtimeslotid" />
    <attribute name="av_name" />
    <attribute name="av_startdatetime" />
    <attribute name="statuscode" />
    <attribute name="av_meetingday" />
    <attribute name="av_duration" />
    <attribute name="av_specialist" />

    <link-entity name="av_invitation_meetingtimeslot" from="av_meetingtimeslotid" to="av_meetingtimeslotid" intersect="true">
      <link-entity name="av_invitation" from="av_invitationid" to="av_invitationid" alias="invitation">
        <filter type="and">   
          <condition attribute="av_invitationid" operator="in" >
                {% for invitation in invitations %}
                      <value>{{ invitation.av_invitationid }}</value>
                {% endfor %}
          </condition>
        </filter>
      </link-entity>
    </link-entity>
  </entity>
</fetch>
  {% endfetchxml %}

 {% assign selected_meeting_time_slots = selected_meeting_time_slot_query.results.entities %}
  
{% endif %}

{% endif %}
{% comment %}
                  <condition attribute="av_interactionsequence" operator="in">
                    {% for meeting in meetings %}
                      <value>{{ meeting.av_currentinteractionsequence }}</value>
                    {% endfor %}
                  </condition>
{% endcomment %}